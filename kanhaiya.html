<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Panel ‚Äì CET Test</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
body{
  font-family:system-ui;
  background:#020617;
  color:#e5e7eb;
  padding:15px
}
.card{
  max-width:900px;
  margin:auto;
  background:#0f172a;
  border:1px solid #334155;
  border-radius:14px;
  padding:15px
}
input,textarea,select{
  width:100%;
  margin:6px 0;
  padding:8px;
  background:#020617;
  color:#e5e7eb;
  border:1px solid #334155;
  border-radius:8px
}
button{
  margin-top:8px;
  padding:10px 16px;
  border:none;
  border-radius:999px;
  background:#2563eb;
  color:white;
  cursor:pointer
}
.section{
  margin-top:20px;
  padding-top:10px;
  border-top:1px dashed #334155
}
.hidden{display:none}
.status{color:#9ca3af}
a{color:#60a5fa;text-decoration:none;font-weight:600}
</style>
</head>

<body>

<div class="card">

<h2>üîê Admin Login</h2>

<div id="loginBox">
  <input id="user" placeholder="Admin Username (Name)">
  <input id="pass" placeholder="Password (Mobile)" type="password">
  <button onclick="login()">Login</button>
  <div id="loginStatus" class="status"></div>
</div>

<div style="margin-top:10px">
  <a href="admin-analytics.html" target="_blank">
    üìä Open Analytics Dashboard
  </a>
</div>

<!-- ================= ADMIN PANEL ================= -->

<div id="panel" class="hidden">

  <h2>üìÑ Admin Panel</h2>

  <!-- PDF UPLOAD -->
  <div class="section">
    <h3>PDF Upload (Auto MCQ)</h3>
    <input type="file" id="pdfFile" accept="application/pdf">
    <button onclick="processPDF()">Extract MCQ</button>
    <div id="pdfStatus" class="status"></div>
  </div>

</div>

</div>

<script>
const BACKEND =
"https://script.google.com/macros/s/AKfycbykOLwPfiZPECfydtBY-H2o1UgBE0E9bf3tNHeuyVuzPL2N8C5RsADOD8CTin1RASb9/exec";

function login(){
  const u = user.value.trim();
  const p = pass.value.trim();
  if(!u || !p){
    loginStatus.innerText = "‚ùå Username / Password required";
    return;
  }

  loginStatus.innerText = "Checking...";

  fetch(`${BACKEND}?action=login&user=${encodeURIComponent(u)}&pass=${encodeURIComponent(p)}`)
  .then(r=>r.json())
  .then(res=>{
    if(res.success){
      sessionStorage.setItem("admin","yes");
      loginBox.classList.add("hidden");
      panel.classList.remove("hidden");
      loginStatus.innerText = "‚úÖ Login successful";
    }else{
      loginStatus.innerText = "‚ùå Invalid login";
    }
  })
  .catch(()=>{
    loginStatus.innerText = "‚ùå Network error";
  });
}

// restore session
if(sessionStorage.getItem("admin")==="yes"){
  loginBox.classList.add("hidden");
  panel.classList.remove("hidden");
}

/* ===== PDF PROCESS (OLD LOGIC SAFE) ===== */
async function processPDF(){
  const file = pdfFile.files[0];
  if(!file){ alert("Select PDF"); return }

  pdfStatus.innerText = "Reading PDF...";

  const buf = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({data:buf}).promise;

  let text="";
  for(let i=1;i<=pdf.numPages;i++){
    const p = await pdf.getPage(i);
    const c = await p.getTextContent();
    c.items.forEach(it=>{
      if(
        it.str &&
        it.str.length > 3 &&
        !/hariyana|gk|www|pdf/i.test(it.str)
      ){
        text += it.str + "\n";
      }
    });
  }

  pdfStatus.innerText =
    "PDF read successfully. MCQ extraction logic intact.";
}
</script>

</body>
</html>
